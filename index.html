<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Navigator</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css">
    <style>
        :root {
            --bg: #ffffff;
            --text: #333333;
            --accent: #2196f3;
            --accent-dark: #1976d2;
            --panel-bg: rgba(255, 255, 255, 0.95);
            --border-color: #dddddd;
            --highlight-bg: #e3f2fd; /* Light blue for highlight */
            --danger: #e74c3c; /* For delete buttons */
        }
        body.dark {
            --bg: #121212;
            --text: #eeeeee;
            --accent: #90caf9;
            --accent-dark: #64b5f6;
            --panel-bg: rgba(30, 30, 30, 0.9);
            --border-color: #444444;
            --highlight-bg: #3f51b5; /* Darker blue for highlight in dark mode */
            --danger: #c0392b;
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden; /* Prevent body scrollbars */
        }
        #map {
            height: 100%;
            width: 100%;
        }
        #toggleBtn {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1100;
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 14px;
            font-size: 20px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background 0.3s;
        }
        #toggleBtn:hover {
            background: var(--accent-dark);
        }
        #sidebar {
            position: absolute;
            left: -320px; /* Needs to be exactly its width or more for full hide */
            top: 0;
            width: 320px;
            height: 100%;
            background: var(--panel-bg);
            padding: 1rem;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            z-index: 1050;
            transition: left 0.3s ease-in-out;
            overflow-y: auto; /* Allow scrolling for content within sidebar */
            display: flex;
            flex-direction: column; /* For footer to stick to bottom */
            box-sizing: border-box; /* Crucial for consistent sizing */
        }
        #sidebar.open {
            left: 0;
        }
        #sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        #sidebar-header h2 {
            margin: 0;
            color: var(--text);
        }
        #sidebar input, #sidebar button, #sidebar select {
            width: 100%;
            margin-bottom: 0.8rem;
            padding: 0.6rem;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg);
            color: var(--text);
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }
        #sidebar button {
            background: var(--accent);
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        #sidebar button:hover {
            background: var(--accent-dark);
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }
        .button-group button {
            flex-grow: 1;
            margin-bottom: 0; /* Override individual button margin */
        }
        /* REVISED AGAIN AND AGAIN (more aggressively): Floating directions panel styles */
        #directionsPanel {
            position: absolute;
            top: 10px;
            right: 10px;
            /* Key adjustment: significantly reduce max-width, prioritizing map visibility */
            max-width: min(60vw, 180px); /* Max 60% of viewport width, but no more than 180px */
            min-width: 160px; /* Keep it readable, but tight */
            max-height: calc(100% - 20px); /* Leave 10px top/bottom margin */
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.4rem; /* Further reduced padding */
            z-index: 1050;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: none; /* Initially hidden */
            overflow-y: auto; /* Allow scrolling for long directions */
            box-sizing: border-box; /* Include padding and border in sizing */
        }
        #directionsPanel header {
            display: flex;
            flex-direction: column; /* Stack title and summary */
            justify-content: space-between;
            align-items: flex-start; /* Align header content to start */
            margin-bottom: 0.4rem; /* Further reduced margin */
            padding-bottom: 0.2rem; /* Adjusted padding */
            border-bottom: 1px solid var(--border-color);
            position: relative; /* For close button positioning */
        }
        #directionsPanel header .title-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            align-items: center;
        }
        #directionsPanel header strong {
            font-size: 0.9rem; /* Smaller font for header */
        }
        #directionsPanel header .route-summary {
            font-size: 0.75rem; /* Smaller font for summary */
            color: #666; /* Slightly muted color */
            margin-top: 0.2rem;
            width: 100%; /* Ensure it takes full width */
            text-align: left;
        }
        #directionsPanel header button {
            background: none;
            border: none;
            font-size: 1.2rem; /* Smaller close button */
            cursor: pointer;
            color: var(--text);
            position: absolute; /* Position close button absolutely */
            top: 0;
            right: 0;
            padding: 0.2rem;
        }
        /* Styles for individual direction steps */
        .dir-step {
            background: var(--highlight-bg);
            padding: 0.25rem 0.4rem; /* Even more reduced padding for steps */
            margin-bottom: 0.25rem; /* Even more reduced margin */
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
            font-size: 0.8rem; /* Even smaller font for steps */
            line-height: 1.1; /* Tighter line spacing for compactness */
        }
        .dir-step.current {
            border: 2px solid var(--accent);
            font-weight: bold;
            box-shadow: 0 0 5px rgba(33, 150, 243, 0.5);
        }

        /* Custom marker for live location arrow */
        .live-location-arrow {
            width: 30px; /* Size of your arrow image */
            height: 30px;
            background-image: url('image_44925c.png'); /* Your arrow image */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transform-origin: center center; /* Rotate around its center */
        }

        #qrModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
        }
        #qrModal.open {
            visibility: visible;
            opacity: 1;
        }
        #qrCanvas {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        footer {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text);
            margin-top: auto; /* Push to bottom of sidebar */
            padding-top: 1rem; /* Space from elements above */
            border-top: 1px solid var(--border-color);
            padding-bottom: 0.5rem; /* Ensure some bottom padding */
        }
        footer a {
            color: var(--accent);
            text-decoration: none;
        }
        #messageArea {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        #messageArea.show {
            opacity: 1;
            visibility: visible;
        }
        #favoritesList li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--highlight-bg);
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
        }
        #favoritesList li span {
            cursor: pointer;
            flex-grow: 1;
            padding-right: 10px; /* Space for delete button */
        }
        #favoritesList li button.delete-fav {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-bottom: 0; /* Override default button margin */
            width: auto; /* Override default button width */
            flex-shrink: 0; /* Don't allow it to shrink */
        }
        #favoritesList li button.delete-fav:hover {
            background: #c0392b; /* Slightly darker red */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="toggleBtn">☰</button>
    <div id="sidebar">
        <div id="sidebar-header">
            <h2>Smart Navigator</h2>
            <button id="closeSidebarBtn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">✖</button>
        </div>
        <input id="from" placeholder="From (e.g. Home)">
        <input id="to" placeholder="To (e.g. Work)">
        <div class="button-group">
            <button id="useLoc">📍 My Location</button>
            <button id="followMeBtn">➡️ Follow Me</button> </div>
        <div class="button-group">
            <button id="saveFav">⭐ Save Fav</button>
            <button id="getRoute">🚗 Get Directions</button>
        </div>
        <div class="button-group">
            <button id="altRoute">🔀 Alt Route</button>
            <button id="qrBtn">🔗 QR</button>
            <button id="shareBtn">📤 Share</button>
        </div>
        <label for="voiceLang">Voice Language:</label>
        <select id="voiceLang">
            <option value="en-US">English</option>
            <option value="es-ES">Español</option>
            <option value="ur-PK">اردو</option>
        </select>
        <button id="themeBtn">🌗 Toggle Theme</button>
        <h4>Favorites</h4>
        <ul id="favoritesList"></ul>

        <footer>
            © 2024-2025 All rights reserved | <a href="https://chrohail.com" target="_blank">chrohail.com</a>
        </footer>
    </div>

    <div id="directionsPanel">
        <header>
            <div class="title-row">
                <strong>Directions</strong>
                <button id="closeDirectionsBtn">❌</button>
            </div>
            <span id="routeSummary" class="route-summary"></span> </header>
        <div id="stepContainer"></div>
    </div>

    <div id="qrModal">
        <canvas id="qrCanvas"></canvas>
    </div>

    <div id="messageArea"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="script.js"></script>
</body>
</html>